include "../cameras/canon_40d.pyr" as response_curves
include "colors.pyr" as colors
include "lamp.pyr" as lamp

image = {
	width = 512
	height = 512
	format = Image.Png
	rgb_curves = response_curves
}

renderer = Renderer.PhotonMapping {
	pixel_samples = 300
	spectrum.samples = 10
	spectrum.bins = 50
	spectrum.span = [400, 700]
	tile_size = 32
	light_samples = 0
	bounces = 4
	light_bounces = 8
	photons = 100000
	photon_bounces = 16
	photon_passes = 2
	radius = 0.1
}

camera = Camera.Perspective {
	fov = 37.7
	transform = Transform.LookAt
	transform.from = Vector(-2.78, -8, 2.73)
	transform.to = Vector(-2.78, 0, 2.73)
	transform.up = Vector { z=1 }
}

light = Material.Emission {
	color = Math.Curve {
		input = Value.Wavelength
		points = lamp.color
	}
}

white = Material.Diffuse {
	color = Math.Curve {
		input = Value.Wavelength
		points = colors.white
	}
}

green = Material.Diffuse {
	color = Math.Curve {
		input = Value.Wavelength
		points = colors.green
	}
}

red = Material.Diffuse {
	color = Math.Curve {
		input = Value.Wavelength
		points = colors.red
	}
}
			min = Vector(-5, 0, 0)
			max = Vector(-3, 2, 2)

world.sky = Sky.Color(0)
world.objects = [
	Shape.Mesh {
		file = "box.obj"
		materials.light = light
		materials.left = red
		materials.right = green

		materials.tall = white
		materials.short = white
		materials.back = white
		materials.ceiling = white
		materials.floor = white
	},
	Shape.RayMarched {
		shape = RayMarched.QuaternionJulia {
			iterations = 50
			threshold = 4
			constant = Vector(-0.2,0.8,0,0)
			slice_plane = 0
			type = QuaternionJulia.Cubic
		}

		bounds = Bounds.Box {
			min = Vector(-7, -1, 0)
			max = Vector(-1, 2, 2)
		}

		material = Material.FresnelMix {
			refract = Material.Diffuse(0.8)
			reflect = Material.Mirror(1)
			ior = 1.5
		}
	}
]